"use strict";const searchIcon=document.querySelector(".js-searchIcon"),searchInput=document.querySelector(".js-searchInput"),searchBtn=document.querySelector(".js-searchBtn"),resetBtn=document.querySelector(".js-resetBtn"),favouritesSection=document.querySelector(".js-favouritesSection"),containerResults=document.querySelector(".js-containerResult"),favouritesCounter=document.querySelector(".js-counter"),starIcons=document.querySelectorAll(".js-starIcon"),favouritesList=document.querySelector(".js-favouritesList"),urlApi="https://api.jikan.moe/v4/anime?q=";let favourites=[],counter=0;const renderFavouritesCounter=()=>{favouritesCounter.innerHTML=""+counter},getApiData=e=>fetch(`${urlApi}${e}`).then(e=>e.json()).then(e=>e.data),handleClickFavouritesCollapsable=()=>{const e=document.querySelector(".js-seriesResult");favouritesSection.classList.toggle("collapsed"),favouritesSection.classList.toggle("favoritesSection"),e.classList.toggle("resultsSectionIfFavouritesOpen"),e.classList.toggle("resultsSection")},favouritesOnLocalStorage="favouritesList",getFavouritesFromLocalStorage=()=>localStorage.getItem("favouritesList"),addFavouriteToLocalStorage=e=>{const t={id:e.id,src:e.querySelector("img").src,name:e.querySelector("h3").innerHTML};let s=JSON.parse(getFavouritesFromLocalStorage());s||(s=[]),s.push(t),localStorage.setItem("favouritesList",JSON.stringify(s))},removeFavouriteToLocalStorage=e=>{let t=JSON.parse(getFavouritesFromLocalStorage());const s=t.findIndex(t=>t.id===e.id);-1!==s&&t.splice(s,1),localStorage.setItem("favouritesList",JSON.stringify(t)),counter--,renderFavouritesCounter()},searchOnResults=e=>{const t=containerResults.querySelector(".js-resultsList"),s=t?t.childNodes:[];return Array.from(s).find(t=>t.id===e.id)},deleteOnResultIfExists=e=>{const t=searchOnResults(e);t&&t.classList.remove("selected")},removeFavourite=e=>{const t=Array.from(favouritesList.childNodes).find(t=>t.id===e.id);deleteOnResultIfExists(e),favouritesList.removeChild(t),removeFavouriteToLocalStorage(e)},addFavourite=e=>{const t=Array.from(favouritesList.childNodes).findIndex(t=>t.id===e.id);if(e.classList.toggle("selected"),-1!==t)return;const s=e.cloneNode(!0);s.classList.add("clonedLiHtmlStyle"),s.removeChild(s.childNodes[s.childNodes.length-1]);const r=document.createElement("button");r.innerHTML+='<i class="deleteBtn__crossIcon far fa-times-circle"></i>';const o=s.appendChild(r);o.classList.add("deleteBtn"),o.classList.add("js-remove-button");const i=favouritesList.appendChild(s);addFavouriteToLocalStorage(s),favourites.push(i),o.addEventListener("click",()=>removeFavourite(s)),counter++,renderFavouritesCounter()},toogleFavourite=e=>{e.classList.contains("selected")?removeFavourite(e):addFavourite(e)};for(const e of starIcons)e.addEventListener("click",handleClickFavouritesCollapsable);const getResultsHtmlCode=(e,t)=>{let s="",r="";return r=e.score>7?"Recomendado":"",null===e.images.webp.image_url?s+=`<li id= "${e.mal_id}" class= 'liResult js-newLiElement ${t?" selected":""}'>\n                            <div class= 'liResult__imgContainer'>\n                              <img class= 'liResult__imgContainer--img' src='https://via.placeholder.com/210x295/ffffff/666666/?text=${e.title}' title='${e.title}' alt='${e.title}'>\n                            </div>\n                            <h3 class= 'liResult__title>${e.title}</h3>\n                          </li>`:s+=`<li id= "${e.mal_id}" class= 'liResult js-newLiElement${t?" selected":""}'>\n                          <div class= 'liResult__imgContainer'>\n                            <img class= 'liResult__imgContainer--img' src='${e.images.webp.image_url}' title='${e.title}' alt='${e.title}'>\n                          </div>\n                          <h3>${e.title}</h3><p class= 'paragraph'>${r}</p></li>`,s},renderResults=(e,t)=>{let s="";const r=JSON.parse(getFavouritesFromLocalStorage());for(const e of t){let t=!1;if(r){t=-1!==r.findIndex(t=>parseInt(t.id)===e.mal_id)}s+=getResultsHtmlCode(e,t)}e.innerHTML+=s},addEventListenerToResults=()=>{containerResults.querySelector(".js-resultsList").childNodes.forEach(e=>{e.addEventListener("click",()=>{var t;(t=e).classList.contains("selected")?removeFavourite(t):addFavourite(t)})})};searchBtn.addEventListener("click",(function(e){e.preventDefault();const t=searchInput.value;if(t.length>=3){const e=document.createElement("ul");e.classList.add("resultsSection__containerResult--seriesList"),e.classList.add("js-resultsList"),containerResults.innerHTML="",(s=t,fetch(`${urlApi}${s}`).then(e=>e.json()).then(e=>e.data)).then(t=>{renderResults(e,t),containerResults.appendChild(e)}).then(()=>{containerResults.querySelector(".js-resultsList").childNodes.forEach(e=>{e.addEventListener("click",()=>{var t;(t=e).classList.contains("selected")?removeFavourite(t):addFavourite(t)})})})}else containerResults.innerHTML="",containerResults.innerHTML="<p> Debes introducir una búqueda válida </p>";var s})),searchIcon.addEventListener("click",()=>{searchInput.classList.toggle("header__form--searchInput"),searchInput.classList.toggle("removeHiddenSearchInput"),searchBtn.classList.toggle("header__form--btns--btnSearch"),searchBtn.classList.toggle("btnsMobile__btnSearchMobile"),resetBtn.classList.toggle("header__form--btns--btnReset"),resetBtn.classList.toggle("btnsMobile__btnResetMobile")});const createLiFromFavouriteObject=e=>{const t=document.createElement("li");t.classList.add("js-newLiElement"),t.classList.add("localStorageLi"),t.id=e.id;const s=document.createElement("img");s.src=e.src,s.classList.add("localStorageLi__favouriteImg"),t.appendChild(s);const r=document.createElement("h3");r.innerHTML=e.name,r.classList.add("localStorageLi__favouriteName"),t.appendChild(r);const o=document.createElement("button");return o.innerHTML+='<i class="localStorageLi__deleteBtn--crossIcon far fa-times-circle"></i>',o.classList.add("localStorageLi__deleteBtn"),o.classList.add("js-remove-button"),t.appendChild(o),o.addEventListener("click",()=>removeFavourite(t)),t},renderFavouritesFromLocalStorage=()=>{const e=JSON.parse(getFavouritesFromLocalStorage());e&&e.length>0&&(e.forEach(e=>{favouritesList.append(createLiFromFavouriteObject(e))}),counter=e.length,renderFavouritesCounter())},resetSearchAndResults=()=>{containerResults.innerHTML=""},trashIcon=document.querySelector(".js-trashIcon");trashIcon.addEventListener("click",()=>{favouritesList.childNodes.forEach(e=>{deleteOnResultIfExists(e),removeFavouriteToLocalStorage(e)}),favouritesList.innerHTML="",counter=0,renderFavouritesCounter()}),resetBtn.addEventListener("click",resetSearchAndResults),renderFavouritesFromLocalStorage();